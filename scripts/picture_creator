import pandas as pd
import matplotlib.pyplot as plt
import os
import glob
import re
from matplotlib.backends.backend_pdf import PdfPages

df = pd.read_csv('../results/benchmark_results.csv', index_col=None, header=0)
bench_names = sorted(set(df['name']))
locks = sorted(set(df['lock']))

paths = []
for bench in bench_names:
    for mode in ['overhead(ms)', 'throughput(ops_ms)']:
        ax = plt.axes(title = bench + '\n mode=' + mode)
        threads = sorted(set(df['threads']))
        ax.set_xticks(threads)
        plt.gcf().set_size_inches(5, 5)
        for lock in locks:
            cur_df = df[(df['name'] == bench) & (df['lock'] == lock)]
            cur_df.sort_values(by=['threads']).plot(ax=ax, x='threads', y=mode, label=lock)
        name = '../results/pictures/' + bench + '_' + mode + '.png'
        paths.append(name)
        plt.savefig(name, bbox_inches="tight")
        plt.close()

from PIL import Image

im1 = Image.open(paths[0]).convert('RGB')
images = []
for i in range(1, len(paths)):
    images.append(Image.open(paths[i]).convert('RGB'))
im1.save(r'../results/result.pdf', save_all=True, append_images=images, dpi=(50, 50))



